Step 1: Load the `payments.csv` file into a dataframe, filter for rows where `card_scheme` is 'GlobalCard' and `is_credit` is True, and create a new column `is_intracountry` (True if `issuing_country` equals `acquirer_country`, else False) to prepare for grouping by transaction characteristics.
Step 2: Load `merchant_data.json` and `fees.json`, then using the full `payments.csv` dataset, calculate the monthly transaction volume and fraud rate (fraudulent volume / total volume) for each merchant (grouping by merchant and month derived from `day_of_year`). Finally, merge these calculated monthly stats and the static merchant attributes (from `merchant_data.json`) into the filtered GlobalCard credit transactions dataframe to prepare for fee matching.
Step 3: Using the dataframe of GlobalCard credit transactions with merged merchant details and monthly statistics from the previous step, iterate through each transaction to find the applicable fee rule from `fees.json`. The matching logic must check that the transaction's attributes (ACI, intracountry status) and the merchant's attributes (MCC, account_type, capture_delay, monthly_volume, monthly_fraud_level) satisfy the rule's criteria. For each matching rule, calculate the fee for a hypothetical 1000 EUR transaction using the formula `fee = fixed_amount + (rate * 1000 / 10000)`, and then calculate the average of these fees.
